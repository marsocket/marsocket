#!/bin/sh
#
# Copyright (C) 2019 marsocket <marsocket@gmail.com>
# This is free software, licensed under the GNU General Public License v3.

CONF_NAME="marsocket"

# $1: name of ListValue (e.g.: nodes)
# $2: index of ListValue (e.g.: 1)
# $3: field of ListValue (e.g.: server)
# $4: default value
uci_get_by_index() {
	local ret=$(uci get $CONF_NAME.@$1[$2].$3 2>/dev/null)
	echo ${ret:=$4}
}

# $1: index of nodes (e.g.: 0 or 1 or 2)
# $2: field of node (e.g.: server)
# $3: default value
get_node_value() {
	uci_get_by_index nodes $1 $2 $3
}

# $1: index of groups (e.g.: 0 or 1 or 2)
# $2: field of group (e.g.: cur_node)
# $3: default value
get_group_value() {
	uci_get_by_index groups $1 $2 $3
}

get_node_bool() {
	case "$(get_node_value $1 $2 0)" in
		1|on|true|yes|enabled) return 0;;
	esac
	return 1
}

get_group_bool() {
	case "$(get_group_value $1 $2 0)" in
		1|on|true|yes|enabled) return 0;;
	esac
	return 1
}









HTTP_CODE=`curl -L -o /dev/null --connect-timeout 10 -s --head -w "%{http_code}" "$1"`
[ ${HTTP_CODE} -ne 200 ] && return 1 || return 0
